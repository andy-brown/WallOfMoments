<!DOCTYPE html>
<html>
    <head>
        <title>Wall of Moments</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <script src="lib/pixi/pixi.js"></script>
    <!-- script src="lib/dash/dash.all.js"></script -->
    <body>
<script>

    var renderer = PIXI.autoDetectRenderer(1920/2, 1084/2, { transparent: true });
    document.body.appendChild(renderer.view);

    // create the root of the scene graph
    var stage = new PIXI.Container();
    var vidPath = '/videos/';
    var vids = ['autumnwatch.mp4', 'philharmonic.webm',
        '4-News-ch-greece-2.webm', 'autumnwatch.mp4'];

    // work out positions
    var x = [0, 0.5, 0, 0.5];
    var y = [0,0,0.5,0.5];
    var crops = [1, null, 2, null];
    var placements = [];
    for(var i=0; i<vids.length; i++){
        var pos = {
            w:renderer.width/2,
            h:renderer.height/2,
            x: renderer.width*x[i],
            y: renderer.height*y[i]
        }
        placements.push(pos);
    }

    // add videos
    var txts = [];
    for(var i=0; i<vids.length; i++){
        var t = addVideoStream(vidPath + vids[i], stage, placements[i], crops[i]);
        txts.push(t);
    }
    animate();

    // play and pause
    setTimeout(function(){
        var videl = txts[0].baseTexture.source;
        console.log(videl.currentTime);
        videl.currentTime = 215;
        // videl.pause();
        // videl.currentSrc = videl.currentSrc + "#t=20,40";
    }, 5000);

    // render the stage
    function animate(){

        // render the stage
        renderer.render(stage);

        requestAnimationFrame(animate);

    }

    function addVideoStream(vid, stage, pos, crop){
        // create a video texture from a path
        var texture = PIXI.Texture.fromVideo(vid);

        // apply crop
        if (crop != null){
            var cropRect = new PIXI.Rectangle(100, 100, 1920/4, 1280/4);
            texture = new PIXI.Texture(texture, cropRect);
        }

        // create a new Sprite using the video texture (yes it's that easy)
        var videoSprite = new PIXI.Sprite(texture);

        videoSprite.width = pos.w; //renderer.width/2;
        videoSprite.height = pos.h;
        videoSprite.x = pos.x; //renderer.width/2;
        videoSprite.y = pos.y; //renderer.width/2;
        stage.addChild(videoSprite);
        return texture;
    }

</script>
</body>
</html>
